<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Dự đoán bit 0-1</title>

<style>
body {
    font-family: Consolas, monospace;
    background: #020617;
    color: #e5e7eb;
    padding: 40px;
}

h3 {
    margin-bottom: 12px;
}

#inputs {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
}

input.bit {
    width: 48px;
    height: 56px;
    text-align: center;
    font-size: 26px;
    background: #020617;
    color: #e5e7eb;
    border: 2px solid #334155;
    border-radius: 8px;
    outline: none;
    transition: 0.15s;
}

input.bit:focus {
    border-color: #22c55e;
    box-shadow: 0 0 0 2px rgba(34,197,94,0.3);
}

button {
    padding: 10px 18px;
    background: #16a34a;
    border: none;
    border-radius: 8px;
    color: white;
    font-size: 16px;
    cursor: pointer;
}

button:hover {
    background: #22c55e;
}

#result {
    margin-top: 20px;
    font-size: 22px;
    color: #22c55e;
}
</style>
</head>

<body>

<h3>Nhập 10 bit (0 / 1)</h3>

<div id="inputs"></div>

<input type="file" id="fileInput">
<br><br>
<button onclick="predict()">Tính bit tiếp theo</button>

<div id="result"></div>

<script>
const inputsDiv = document.getElementById("inputs");

// tạo 10 ô nhập
for (let i = 0; i < 10; i++) {
    const inp = document.createElement("input");
    inp.className = "bit";
    inp.maxLength = 1;
    inp.dataset.index = i;

    inp.addEventListener("input", e => {
        const v = e.target.value;
        if (v !== "0" && v !== "1") {
            e.target.value = "";
            return;
        }
        const next = inputsDiv.querySelector(
            `input[data-index='${i + 1}']`
        );
        if (next) next.focus();
    });

    inp.addEventListener("keydown", e => {
        if (e.key === "Backspace" && !inp.value) {
            const prev = inputsDiv.querySelector(
                `input[data-index='${i - 1}']`
            );
            if (prev) prev.focus();
        }
    });

    inputsDiv.appendChild(inp);
}

// focus ô đầu tiên khi load trang
window.onload = () => {
    inputsDiv.querySelector("input").focus();
};

let historyBits = "";

document.getElementById("fileInput").addEventListener("change", e => {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = () => {
        historyBits = reader.result.replace(/[^01]/g, "");
        alert("Đã nạp " + historyBits.length + " bit");
    };
    reader.readAsText(file);
});

function predict() {
    if (historyBits.length < 11) {
        alert("Chưa có dữ liệu lịch sử");
        return;
    }

    const inputs = [...inputsDiv.querySelectorAll("input")]
        .map(i => i.value)
        .join("");

    if (inputs.length < 10) {
        alert("Chưa nhập đủ 10 bit");
        return;
    }

    let count0 = 0;
    let count1 = 0;

    for (let i = 0; i <= historyBits.length - 11; i++) {
        if (historyBits.substr(i, 10) === inputs) {
            const nextBit = historyBits[i + 10];
            if (nextBit === "0") count0++;
            else count1++;
        }
    }

    let text;
    if (count0 === 0 && count1 === 0) {
        text = "Không có mẫu trùng trong lịch sử";
    } else if (count1 > count0) {
        text = `→ Đề xuất: 1  (1:${count1} | 0:${count0})`;
    } else {
        text = `→ Đề xuất: 0  (0:${count0} | 1:${count1})`;
    }

    document.getElementById("result").innerText = text;
}
</script>

</body>
</html>
